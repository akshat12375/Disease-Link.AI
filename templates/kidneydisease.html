{% extends "layout.html" %}
{% set no_default_css = true %}

{% block head %}
  <style>
    :root { --glass-bg: rgba(255,255,255,0.06); --glass-border: rgba(255,255,255,0.08); }
    .glass {
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      backdrop-filter: blur(8px) saturate(120%);
    }
   .custom-shap-container {
       background-color: rgba(0, 0, 0, 0.2); /* Darker background for contrast */
       border: 1px solid rgba(255, 255, 255, 0.1);
       border-radius: 1rem;
       padding: 1.5rem;
       margin-top: 2rem;
   }
  </style>
{% endblock %}

{% block content %}
<section class="min-h-[80vh] md:min-h-[85vh] py-16" style="background: linear-gradient(120deg,#0ea5e9 0%,#7c3aed 100%)">
  <div class="max-w-4xl mx-auto px-6 text-center">

    <img src="/static/download.jpeg" class="w-40 mx-auto drop-shadow-xl mb-6 rounded-full" alt="Kidney Icon">

    <h1 class="text-4xl md:text-5xl font-extrabold text-white tracking-tight mb-4">
        ðŸ©º Kidney Disease Prediction
    </h1>

    <div class="glass p-8 md:p-10 rounded-2xl shadow-2xl border-white/20 mt-8">

        <form action="{{ url_for('predictkidney') }}" method="post" class="text-left space-y-6">

            <div class="grid md:grid-cols-3 gap-6">

                <div>
                    <label class="block font-medium text-white/80">Anaemia (0/1)</label>
                    <input type="number" step="any" name="ane" required class="w-full p-3 rounded-xl border border-white/20 bg-white/10 text-white shadow-sm placeholder-white/50 focus:ring-2 focus:ring-sky-400 outline-none">
                </div>

                <div>
                    <label class="block font-medium text-white/80">Blood Pressure</label>
                    <input type="number" step="any" name="bp" required class="w-full p-3 rounded-xl border border-white/20 bg-white/10 text-white shadow-sm placeholder-white/50 focus:ring-2 focus:ring-sky-400 outline-none">
                </div>

                <div>
                    <label class="block font-medium text-white/80">Specific Gravity</label>
                    <input type="number" step="any" name="sg" required class="w-full p-3 rounded-xl border border-white/20 bg-white/10 text-white shadow-sm placeholder-white/50 focus:ring-2 focus:ring-sky-400 outline-none">
                </div>

                <div>
                    <label class="block font-medium text-white/80">Albumin</label>
                    <input type="number" step="any" name="al" required class="w-full p-3 rounded-xl border border-white/20 bg-white/10 text-white shadow-sm placeholder-white/50 focus:ring-2 focus:ring-sky-400 outline-none">
                </div>

                <div>
                    <label class="block font-medium text-white/80">Sugar</label>
                    <input type="number" step="any" name="su" required class="w-full p-3 rounded-xl border border-white/20 bg-white/10 text-white shadow-sm placeholder-white/50 focus:ring-2 focus:ring-sky-400 outline-none">
                </div>

                <div>
                    <label class="block font-medium text-white/80">Red Blood Cells</label>
                    <input type="text" name="rbc" required class="w-full p-3 rounded-xl border border-white/20 bg-white/10 text-white shadow-sm placeholder-white/50 focus:ring-2 focus:ring-sky-400 outline-none">
                </div>

                <div>
                    <label class="block font-medium text-white/80">Pus Cell Clumps</label>
                    <input type="text" name="pcc" required class="w-full p-3 rounded-xl border border-white/20 bg-white/10 text-white shadow-sm placeholder-white/50 focus:ring-2 focus:ring-sky-400 outline-none">
                </div>

                <div>
                    <label class="block font-medium text-white/80">Bacteria</label>
                    <input type="text" name="ba" required class="w-full p-3 rounded-xl border border-white/20 bg-white/10 text-white shadow-sm placeholder-white/50 focus:ring-2 focus:ring-sky-400 outline-none">
                </div>

                <div>
                    <label class="block font-medium text-white/80">Blood Glucose Random</label>
                    <input type="number" step="any" name="bgr" required class="w-full p-3 rounded-xl border border-white/20 bg-white/10 text-white shadow-sm placeholder-white/50 focus:ring-2 focus:ring-sky-400 outline-none">
                </div>

                <div>
                    <label class="block font-medium text-white/80">Blood Urea</label>
                    <input type="number" step="any" name="bu" required class="w-full p-3 rounded-xl border border-white/20 bg-white/10 text-white shadow-sm placeholder-white/50 focus:ring-2 focus:ring-sky-400 outline-none">
                </div>

                <div>
                    <label class="block font-medium text-white/80">Serum Creatinine</label>
                    <input type="number" step="any" name="sc" required class="w-full p-3 rounded-xl border border-white/20 bg-white/10 text-white shadow-sm placeholder-white/50 focus:ring-2 focus:ring-sky-400 outline-none">
                </div>

                <div>
                    <label class="block font-medium text-white/80">Sodium</label>
                    <input type="number" step="any" name="sod" required class="w-full p-3 rounded-xl border border-white/20 bg-white/10 text-white shadow-sm placeholder-white/50 focus:ring-2 focus:ring-sky-400 outline-none">
                </div>

                <div>
                    <label class="block font-medium text-white/80">Potassium</label>
                    <input type="number" step="any" name="pot" required class="w-full p-3 rounded-xl border border-white/20 bg-white/10 text-white shadow-sm placeholder-white/50 focus:ring-2 focus:ring-sky-400 outline-none">
                </div>

                <div>
                    <label class="block font-medium text-white/80">Hemoglobin</label>
                    <input type="number" step="any" name="hemo" required class="w-full p-3 rounded-xl border border-white/20 bg-white/10 text-white shadow-sm placeholder-white/50 focus:ring-2 focus:ring-sky-400 outline-none">
                </div>

                <div>
                    <label class="block font-medium text-white/80">Packed Cell Volume</label>
                    <input type="number" step="any" name="pcv" required class="w-full p-3 rounded-xl border border-white/20 bg-white/10 text-white shadow-sm placeholder-white/50 focus:ring-2 focus:ring-sky-400 outline-none">
                </div>

                <div>
                    <label class="block font-medium text-white/80">White Blood Cell Count</label>
                    <input type="number" step="any" name="wc" required class="w-full p-3 rounded-xl border border-white/20 bg-white/10 text-white shadow-sm placeholder-white/50 focus:ring-2 focus:ring-sky-400 outline-none">
                </div>

                <div>
                    <label class="block font-medium text-white/80">Red Blood Cell Count</label>
                    <input type="number" step="any" name="rc" required class="w-full p-3 rounded-xl border border-white/20 bg-white/10 text-white shadow-sm placeholder-white/50 focus:ring-2 focus:ring-sky-400 outline-none">
                </div>

                <div>
                    <label class="block font-medium text-white/80">Hypertension</label>
                    <input type="text" name="htn" required class="w-full p-3 rounded-xl border border-white/20 bg-white/10 text-white shadow-sm placeholder-white/50 focus:ring-2 focus:ring-sky-400 outline-none">
                </div>

                <div>
                    <label class="block font-medium text-white/80">Diabetes Mellitus</label>
                    <input type="text" name="dm" required class="w-full p-3 rounded-xl border border-white/20 bg-white/10 text-white shadow-sm placeholder-white/50 focus:ring-2 focus:ring-sky-400 outline-none">
                </div>

                <div>
                    <label class="block font-medium text-white/80">Coronary Artery Disease</label>
                    <input type="text" name="cad" required class="w-full p-3 rounded-xl border border-white/20 bg-white/10 text-white shadow-sm placeholder-white/50 focus:ring-2 focus:ring-sky-400 outline-none">
                </div>

                <div>
                    <label class="block font-medium text-white/80">Appetite</label>
                    <input type="text" name="appet" required class="w-full p-3 rounded-xl border border-white/20 bg-white/10 text-white shadow-sm placeholder-white/50 focus:ring-2 focus:ring-sky-400 outline-none">
                </div>

                <div>
                    <label class="block font-medium text-white/80">Pedal Edema</label>
                    <input type="text" name="pe" required class="w-full p-3 rounded-xl border border-white/20 bg-white/10 text-white shadow-sm placeholder-white/50 focus:ring-2 focus:ring-sky-400 outline-none">
                </div>

                <div>
                    <label class="block font-medium text-white/80">Pus Cells (0/1)</label>
                    <input type="number" step="any" name="pc" required class="w-full p-3 rounded-xl border border-white/20 bg-white/10 text-white shadow-sm placeholder-white/50 focus:ring-2 focus:ring-sky-400 outline-none">
                </div>

                
                <div class="md:col-span-3">
                    <label class="block font-medium text-white/80">Age</label>
                    <input type="number" step="any" name="age" required class="w-full p-3 rounded-xl border border-white/20 bg-white/10 text-white shadow-sm placeholder-white/50 focus:ring-2 focus:ring-sky-400 outline-none">
                </div>

            </div>

            <button class="mt-6 w-full bg-white/95 text-slate-900 py-3 rounded-2xl text-lg font-semibold hover:bg-white shadow-xl transition">
                ðŸ§ª Predict Kidney Condition
            </button>
        </form>

        {% if output_text %}
        <div class="mt-8 text-lg font-semibold text-white bg-black/20 p-4 rounded-xl">
            {{ output_text }}
        </div>
        {% endif %}

        {% if shap_plot or shap_summary %}
        <div class="custom-shap-container">

            <h3 class="text-xl font-semibold mb-3 text-white">Model Explanation (SHAP)</h3>

            {% if shap_insight_text %}
            <p class="text-white/80 mb-4">{{ shap_insight_text }}</p>
            {% endif %}

            {% if shap_summary %}
            <ul class="text-left text-white/90 space-y-2 mb-4">
                {% for item in shap_summary.positive %}
                <li>â€¢ {{ item.feature }} â€” <strong class="font-semibold">{{ item.impact }}</strong></li>
                {% endfor %}
            </ul>
            {% endif %}

            {% if shap_plot %}
            <img src="data:image/png;base64,{{ shap_plot }}" class="rounded-xl shadow-md mx-auto">
            {% endif %}

        </div>
        {% endif %}

    </div>
  </div>
</section>
{% endblock %}
