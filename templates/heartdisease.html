{% extends "layout.html" %}
{% set no_default_css = true %}

{% block head %}
  <style>
    :root { --glass-bg: rgba(255,255,255,0.06); --glass-border: rgba(255,255,255,0.08); }
    .glass {
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      backdrop-filter: blur(8px) saturate(120%);
    }
    .custom-shap-container {
      background-color: rgba(0, 0, 0, 0.2); /* Darker background for contrast */
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 1rem;
      padding: 1.5rem;
      margin-top: 2rem;
    }
  </style>
{% endblock %}

{% block content %}
<section class="min-h-[80vh] md:min-h-[85vh] py-16" style="background: linear-gradient(120deg,#0ea5e9 0%,#7c3aed 100%)">
  <div class="max-w-4xl mx-auto px-6 text-center">

    <img src="/static/heartdisease.png" class="w-40 mx-auto drop-shadow-xl mb-6" alt="Heart Icon">

    <h1 class="text-4xl md:text-5xl font-extrabold text-white tracking-tight mb-4">
        ‚ù§Ô∏è Heart Disease Prediction
    </h1>

    <div class="glass p-8 md:p-10 rounded-2xl shadow-2xl border-white/20 mt-8">

        <form action="{{ url_for('predictheart') }}" method="post" class="text-left space-y-6">

            <div class="grid md:grid-cols-3 gap-6">

                <div>
                    <label class="block font-medium text-white/80">Age</label>
                    <input type="number" step="any" name="age" required class="w-full p-3 rounded-xl border border-white/20 bg-white/10 text-white shadow-sm placeholder-white/50 focus:ring-2 focus:ring-sky-400 outline-none">
                </div>

                <div>
                    <label class="block font-medium text-white/80">Anaemia (0/1)</label>
                    <input type="number" step="any" name="ane" required class="w-full p-3 rounded-xl border border-white/20 bg-white/10 text-white shadow-sm placeholder-white/50 focus:ring-2 focus:ring-sky-400 outline-none">
                </div>

                <div>
                    <label class="block font-medium text-white/80">Creatinine Phosphokinase</label>
                    <input type="number" step="any" name="creatinine_phosphokinase" required class="w-full p-3 rounded-xl border border-white/20 bg-white/10 text-white shadow-sm placeholder-white/50 focus:ring-2 focus:ring-sky-400 outline-none">
                </div>

                <div>
                    <label class="block font-medium text-white/80">Has Diabetes (0/1)</label>
                    <input type="number" step="any" name="y_diabetes" required class="w-full p-3 rounded-xl border border-white/20 bg-white/10 text-white shadow-sm placeholder-white/50 focus:ring-2 focus:ring-sky-400 outline-none">
                </div>

                <div>
                    <label class="block font-medium text-white/80">Ejection Fraction</label>
                    <input type="number" step="any" name="ejection_fraction" required class="w-full p-3 rounded-xl border border-white/20 bg-white/10 text-white shadow-sm placeholder-white/50 focus:ring-2 focus:ring-sky-400 outline-none">
                </div>

                <div>
                    <label class="block font-medium text-white/80">High Blood Pressure (0/1)</label>
                    <input type="number" step="any" name="high_blood_pressure" required class="w-full p-3 rounded-xl border border-white/20 bg-white/10 text-white shadow-sm placeholder-white/50 focus:ring-2 focus:ring-sky-400 outline-none">
                </div>

                <div>
                    <label class="block font-medium text-white/80">Platelets Count</label>
                    <input type="number" step="any" name="platelets" required class="w-full p-3 rounded-xl border border-white/20 bg-white/10 text-white shadow-sm placeholder-white/50 focus:ring-2 focus:ring-sky-400 outline-none">
                </div>

                <div>
                    <label class="block font-medium text-white/80">Serum Creatinine</label>
                    <input type="number" step="any" name="serum_creatinine" required class="w-full p-3 rounded-xl border border-white/20 bg-white/10 text-white shadow-sm placeholder-white/50 focus:ring-2 focus:ring-sky-400 outline-none">
                </div>

                <div>
                    <label class="block font-medium text-white/80">Serum Sodium</label>
                    <input type="number" step="any" name="serum_sodium" required class="w-full p-3 rounded-xl border border-white/20 bg-white/10 text-white shadow-sm placeholder-white/50 focus:ring-2 focus:ring-sky-400 outline-none">
                </div>

                <div>
                    <label class="block font-medium text-white/80">Gender (0=F, 1=M)</label>
                    <input type="number" step="any" name="gender" required class="w-full p-3 rounded-xl border border-white/20 bg-white/10 text-white shadow-sm placeholder-white/50 focus:ring-2 focus:ring-sky-400 outline-none">
                </div>

                <div>
                    <label class="block font-medium text-white/80">Smoking (0/1)</label>
                    <input type="number" step="any" name="smoking" required class="w-full p-3 rounded-xl border border-white/20 bg-white/10 text-white shadow-sm placeholder-white/50 focus:ring-2 focus:ring-sky-400 outline-none">
                </div>

                <div>
                    <label class="block font-medium text-white/80">Follow-up Time (days)</label>
                    <input type="number" step="any" name="time" required class="w-full p-3 rounded-xl border border-white/20 bg-white/10 text-white shadow-sm placeholder-white/50 focus:ring-2 focus:ring-sky-400 outline-none">
                </div>
            </div>

            <button class="mt-6 w-full bg-white/95 text-slate-900 py-3 rounded-2xl text-lg font-semibold hover:bg-white shadow-xl transition">
                üíì Predict Heart Condition
            </button>
        </form>

        {% if output_text %}
        <div class="mt-8 text-lg font-semibold text-white bg-black/20 p-4 rounded-xl">
            {{ output_text }}
        </div>
        {% endif %}

        {% if shap_plot or shap_summary %}
        <div class="custom-shap-container">

            <h3 class="text-xl font-semibold mb-3 text-white">Model Explanation (SHAP)</h3>

            {% if shap_insight_text %}
            <p class="text-white/80 mb-4">{{ shap_insight_text }}</p>
            {% endif %}

            {% if shap_summary %}
            <ul class="text-left text-white/90 space-y-2 mb-4">
                {% for item in shap_summary.positive %}
                <li>‚Ä¢ {{ item.feature }} ‚Äî <strong class="font-semibold">{{ item.impact }}</strong></li>
                {% endfor %}
            </ul>
            {% endif %}

            {% if shap_plot %}
            <img src="data:image/png;base64,{{ shap_plot }}" class="rounded-xl shadow-md mx-auto">
            {% endif %}

        </div>
        {% endif %}

    </div>
  </div>
</section>
{% endblock %}
